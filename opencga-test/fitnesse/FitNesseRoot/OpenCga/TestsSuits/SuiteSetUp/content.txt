!define TEST_SYSTEM {slim}
!path target/appassembler/dependencies/*.jar
!define baseURL {http://bioinfoint.hpc.cam.ac.uk/opencga-1.0.0-final/webservices/rest/}
!define user {test}
!define study {2}


!|import|
|smartrics.rest.fitnesse.fixture|

!|Table: Rest Fixture Config|
|restfixture.display.toggle.for.cells.larger.than|200|
|restfixture.display.actual.on.right | false |
|http.client.connection.timeout| 100000|

!3 Generate Random Variables 
!|Table: Rest Fixture | ${baseURL} |
|let|userA|js|Math.random().toString(36).replace(/[^a-z]+/g, '').substr(0, 5)||
|let|userB|js|Math.random().toString(36).replace(/[^a-z]+/g, '').substr(0, 5)||

!3 Login User 
!|Table: Rest Fixture | http://bioinfoint.hpc.cam.ac.uk/opencga-1.0.0-final/webservices/rest/  |
| setBody | {"password" : "user_P@ssword"}|
| setHeader|Content-Type:application/json|
| POST | /v1/users/${user}/login |200|  Content-Type: application/json ||
|let|sessionId|js|response.jsonbody.response[0].result[0].sessionId||

#userA has Full Permissions
!3 Create userA  
!|Table: Rest Fixture  | ${baseURL} |
| setBody |  { "name": "$userA", "userId": "$userA","email": "test@test.com", "password" : "p@ssword" }|
| setHeader|Content-Type:application/json|
| POST | /v1/users/create?sid=$sessionId |200| Content-Type : application/json| jsonbody.error === '' |

#userB has Empty(no) Permissions
!3 Create userB  
!|Table: Rest Fixture  | ${baseURL} |
| setBody |  { "name": "$userB", "userId": "$userB","email": "test@test.com", "password" : "p@ssword" }|
| setHeader|Content-Type:application/json|
| POST | /v1/users/create?sid=$sessionId |200| Content-Type : application/json| jsonbody.error === '' |


!3 Create ACL for User (userA)
!|Table: Rest Fixture | http://bioinfoint.hpc.cam.ac.uk/opencga-1.0.0-final/webservices/rest/  |
| setBody | {"members" : "$userA"}|
| setHeader|Content-Type:application/json|
| POST | /v1/studies/${study}/acl/create?sid=$sessionId |200|  Content-Type: application/json ||

